@using Medicloud.Models.ViewModels
@model HomePageViewModel;


<div class="row">
     @Html.Partial("_SubscriptionAlert")

    <div class="col-12">
        <div class="page-title-box">
            <div class="page-title-right">
                <form class="d-flex">
                    <div class="input-group">
                        <input type="text" class="form-control form-control-light" id="dash-daterange">
                        <span class="input-group-text bg-primary border-primary text-white">
                            <i class="mdi mdi-calendar-range font-13"></i>
                        </span>
                    </div>
                    <a href="javascript: void(0);" class="btn btn-primary ms-2">
                        <i class="mdi mdi-autorenew"></i>
                    </a>
                    <a href="javascript: void(0);" class="btn btn-primary ms-1">
                        <i class="mdi mdi-filter-variant"></i>
                    </a>
                </form>
            </div>
            <h4 class="page-title">İdarə paneli</h4>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-xl-12 col-lg-12">

        <div class="row">
            <div class="col-sm-6">
                <div class="card widget-flat">
                    <div class="card-body">
                        <div class="float-end">
                            <i class="mdi mdi-account-multiple widget-icon"></i>
                        </div>
                        <h5 class="text-muted fw-normal mt-0" title="Müştəri Sayı">Müştərilər</h5>
                        <h3 class="mt-3 mb-3">@Model.patientStatisticsDTO.newCustomersThisMonth</h3>
                        <p class="mb-0 text-muted">

                            @if (Model.patientStatisticsDTO.isGrow > 0)
                            {
                                <span class="text-success me-2">
                                    <i class="mdi mdi-arrow-up-bold"></i> @(string.IsNullOrEmpty(Model.patientStatisticsDTO.percentage) ? "0" : Model.patientStatisticsDTO.percentage)%
                                </span>
                            }
                            else
                            {
                                <span class="text-danger me-2"><i class="mdi mdi-arrow-down-bold"></i> @(string.IsNullOrEmpty(Model.patientStatisticsDTO.percentage) ? "0" : Model.patientStatisticsDTO.percentage)%</span>
                            }

                            <span class="text-nowrap">Keçən aydan</span>
                        </p>
                    </div> <!-- end card-body-->
                </div> <!-- end card-->
            </div> <!-- end col-->

            <div class="col-sm-6">
                <div class="card widget-flat">
                    <div class="card-body">
                        <div class="float-end">
                            <i class="mdi mdi-cart-plus widget-icon"></i>
                        </div>
                        <h5 class="text-muted fw-normal mt-0" title="Müraciət Sayı">Müraciət</h5>
                        <h3 class="mt-3 mb-3">@(string.IsNullOrEmpty(Model.patientCardStatisticsDTO.visitsThisMonth) ? "0" : Model.patientCardStatisticsDTO.visitsThisMonth) </h3>
                        <p class="mb-0 text-muted">

                            @if (Model.patientCardStatisticsDTO.isGrow > 0)
                            {
                                <span class="text-success me-2">
                                    <i class="mdi mdi-arrow-up-bold"></i> @(string.IsNullOrEmpty(Model.patientCardStatisticsDTO.percentage) ? "0" : Model.patientCardStatisticsDTO.percentage)%
                                </span>
                            }
                            else
                            {
                                <span class="text-danger me-2"><i class="mdi mdi-arrow-down-bold"></i>  @(string.IsNullOrEmpty(Model.patientCardStatisticsDTO.percentage) ? "0" : Model.patientCardStatisticsDTO.percentage)%</span>
                            }

                            <span class="text-nowrap">Keçən aydan</span>
                        </p>
                    </div> <!-- end card-body-->
                </div> <!-- end card-->
            </div> <!-- end col-->
        </div> <!-- end row -->
        <!--<div class="row">
            <div class="col-sm-6">
                <div class="card widget-flat">
                    <div class="card-body">
                        <div class="float-end">
                            <i class="mdi mdi-currency-usd widget-icon"></i>
                        </div>
                        <h5 class="text-muted fw-normal mt-0" title="Orta Gəlir">Gəlir</h5>
                        <h3 class="mt-3 mb-3">@(string.IsNullOrEmpty(Model.paymentOperationStatisticsDTO.incomeThisMonth) ? "0" : Model.paymentOperationStatisticsDTO.incomeThisMonth ) AZN</h3>
                        <p class="mb-0 text-muted">
                            @if (Model.paymentOperationStatisticsDTO.isGrow > 0)
                            {
                                <span class="text-success me-2">
                                    <i class="mdi mdi-arrow-up-bold"></i>@(string.IsNullOrEmpty(Model.paymentOperationStatisticsDTO.percentage) ? "0" : Model.paymentOperationStatisticsDTO.percentage)%
                                </span>
                            }
                            else
                            {
                        <span class="text-danger me-2"><i class="mdi mdi-arrow-down-bold"></i> @(string.IsNullOrEmpty(Model.paymentOperationStatisticsDTO.percentage) ? "0" : Model.paymentOperationStatisticsDTO.percentage)%</span>
                            }
                            <span class="text-nowrap">Keçən aydan</span>
                        </p>
                    </div>-->
        <!-- end card-body-->
        <!--</div>--> <!-- end card-->
        <!--</div>--> <!-- end col-->
        <!--<div class="col-sm-6">
            <div class="card widget-flat">
                <div class="card-body">
                    <div class="float-end">
                        <i class="mdi mdi-pulse widget-icon"></i>
                    </div>
                    <h5 class="text-muted fw-normal mt-0" title="Artım">----</h5>
                    <h3 class="mt-3 mb-3">----</h3>
                    <p class="mb-0 text-muted">
                        <span class="text-success me-2"><i class="mdi mdi-arrow-up-bold"></i> ---</span>
                        <span class="text-nowrap">----</span>
                    </p>
                </div>-->
        <!-- end card-body-->
        <!--</div>--> <!-- end card-->
        <!--</div>--> <!-- end col-->
        <!--</div>--> <!-- end row -->

    </div> <!-- end col -->
    <!--<div class="col-xl-7 col-lg-6">
        <div class="card card-h-100">
            <div class="d-flex card-header justify-content-between align-items-center">
                <h4 class="header-title">Proqnozlar</h4>
                <div class="dropdown">
                    <a href="index.html#" class="dropdown-toggle arrow-none card-drop" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="mdi mdi-dots-vertical"></i>
                    </a>
                    <div class="dropdown-menu dropdown-menu-end">-->
    <!-- item-->
    <!--<a href="javascript:void(0);" class="dropdown-item">Sales Report</a>-->
    <!-- item-->
    <!--<a href="javascript:void(0);" class="dropdown-item">Export Report</a>-->
    <!-- item-->
    <!--<a href="javascript:void(0);" class="dropdown-item">Profit</a>-->
    <!-- item-->
    <!--<a href="javascript:void(0);" class="dropdown-item">Action</a>
            </div>
        </div>
    </div>
    <div class="card-body pt-0">
        <div dir="ltr">
            <div id="high-performing-product" class="apex-charts" data-colors="#727cf5,#e3eaef"></div>
        </div>

    </div>-->
    <!-- end card-body-->
    <!--</div>--> <!-- end card-->
    <!--</div>--> <!-- end col -->
</div>
<!-- end row -->
<!-- end row -->

<div class="row">
    <div class="col-xl-6 col-lg-12 order-lg-2 order-xl-1">
        <div class="card">
            <div class="d-flex card-header justify-content-between align-items-center">
                <h4 class="header-title">Ən Çox Satılan Xidmət</h4>
                @*<a href="javascript:void(0);" class="btn btn-sm btn-light">Export <i class="mdi mdi-download ms-1"></i></a>*@
            </div>

            <div class="card-body pt-0">
                <div class="table-responsive">
                    @if (Model.top5sellingServiceStatistics != null && Model.top5sellingServiceStatistics.Any())
                    {
                        <table class="table table-centered table-nowrap table-hover mb-0">
                            <tbody>
                                @foreach (var item in Model.top5sellingServiceStatistics)
                                {
                                    <tr>
                                        <td>
                                            <h5 class="font-14 my-1 fw-normal">@item.name</h5>
                                            <span class="text-muted font-13">@item.lastPurchaseDate.ToString("dd MMMM yyyy")</span>
                                        </td>
                                        <td>
                                            <h5 class="font-14 my-1 fw-normal">@item.price</h5>
                                            <span class="text-muted font-13">Qiymət</span>
                                        </td>
                                        <td>
                                            <h5 class="font-14 my-1 fw-normal">@item.quantity</h5>
                                            <span class="text-muted font-13">Say</span>
                                        </td>
                                        <td>
                                            <h5 class="font-14 my-1 fw-normal">@item.amount AZN</h5>
                                            <span class="text-muted font-13">Məbləğ</span>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    }
                    else
                    {
                        <div class="text-center">
                            <i class="ri-file-search-line" style="font-size: 48px; color: #ccc;"></i>
                            <h4 class="mt-3">Yetərincə məlumat yoxdur</h4>
                        </div>
                    }
                </div> <!-- end table-responsive-->
            </div> <!-- end card-body-->

        </div> <!-- end card-->
    </div> <!-- end col-->

    <div class="col-xl-6 col-lg-12 order-lg-1">
        <div class="card">
            <div class="d-flex card-header justify-content-between align-items-center">
                <h4 class="header-title">Ümumi Satış</h4>

            </div>
            <div class="card-body pt-0">
                @if (Model.top5sellingServiceStatistics != null && Model.top5sellingServiceStatistics.Any())
                {
                    var colors = new[] { "#727cf5", "#0acf97", "#fa5c7c", "#ffbc00", "#f76397" };
                    <div id="sales-chart" class="apex-charts mb-4 mt-2"></div>
                    <div class="chart-widget-list">


                        @for (int i = 0; i < Model.top5sellingServiceStatistics.Count; i++)
                        {
                            var item = Model.top5sellingServiceStatistics[i];
                            <p>
                                <i class="mdi mdi-square" style="color:@colors[i % colors.Length];"></i> @item.name
                                <span class="float-end">@item.amount AZN</span>
                            </p>
                        }

                    </div>
                }
                else
                {
                    <div class="text-center">
                        <i class="ri-file-search-line" style="font-size: 48px; color: #ccc;"></i>
                        <h4 class="mt-3">Yetərincə məlumat yoxdur</h4>
                    </div>
                }
            </div> <!-- end card-body-->
        </div> <!-- end card-->
    </div> <!-- end col-->

</div>
<!-- end row -->
@{
    // Prepare your data in the controller and pass it to the view
    // For demonstration, I'm assuming 'Model.dailyIncomeStatistics' is a list of some sort containing 'incomeThisWeek' properties
    // We need to convert these properties into a JavaScript array
    var currentWeekData = Model.dailyIncomeStatistics.Select(stat => stat.incomeThisWeek).ToArray();
    var previousWeekData = Model.dailyIncomeStatistics.Select(stat => stat.incomePreviousWeek).ToArray();
    var categories = Model.dailyIncomeStatistics.Select(stat => stat.weekDay).ToArray();

    // Serialize your data arrays to JSON
    var currentWeekDataJson = Html.Raw(Json.Serialize(currentWeekData));
    var previousWeekDataJson = Html.Raw(Json.Serialize(previousWeekData));
    var categoriesJson = Html.Raw(Json.Serialize(categories));
}

@section Scripts {
    <script>
        // Custom initialization function for the revenue chart
        function initRevenueChart(currentWeekData, previousWeekData, categories) {
            var options = {
                chart: {
                    height: 370,
                    type: "line",
                    dropShadow: {
                        enabled: !0,
                        opacity: .2,
                        blur: 7,
                        left: -7,
                        top: 7
                    }
                },
                dataLabels: {
                    enabled: !1
                },
                stroke: {
                    curve: "smooth",
                    width: 4
                },
                series: [{
                    name: "Cari həftə",
                    data: currentWeekData
                }, {
                    name: "Keçən həftə",
                    data: previousWeekData
                }],
                xaxis: {
                    type: "string",
                    //categories: categories,
                    categories: ['Bazar ertəsi', 'Çərşənbə axşamı', 'Çərşənbə', 'Cümə axşamı', 'Cümə', 'Şənbə', 'Bazar'],
                    tooltip: {
                        enabled: !1
                    },
                    axisBorder: {
                        show: !1
                    }

                },

                zoom: {
                    enabled: !1
                },
                legend: {
                    show: !1
                },

                grid: {
                    strokeDashArray: 7
                },
                yaxis: {
                    labels: {
                        formatter: function (e) {
                            return e + " AZN"
                        },
                        offsetX: -15
                    }
                }
                // ...other chart configurations
            };

            var chart = new ApexCharts(document.querySelector("#revenue-chart-real"), options);
            chart.render();
        }

        // Call the initRevenueChart function with the data from the Razor view
        document.addEventListener("DOMContentLoaded", function() {
            initRevenueChart(@currentWeekDataJson, @previousWeekDataJson, @categoriesJson);
        });
    </script>


    <script>
        document.addEventListener("DOMContentLoaded", function() {
            function getColorByIndex(index) {
                var colors = ['#727cf5', '#0acf97', '#fa5c7c', '#ffbc00', '#f76397'];
                return colors[index % colors.length];
            }

            var categories = @Html.Raw(Json.Serialize(Model.top5sellingServiceStatistics.Select(s => s.name).ToArray()));
            var seriesData = @Html.Raw(Json.Serialize(Model.top5sellingServiceStatistics.Select(s => s.amount).ToArray()));
seriesData = seriesData.map(Number);
            var colors = seriesData.map((_, index) => getColorByIndex(index));

            var options = {
                chart: {
                    height: 350,
                    type: 'donut'
                },
                series: seriesData,
                labels: categories,
                colors: colors,
                legend: {
                    show: true,
                    position: 'bottom'
                },
                stroke: {
                    colors: ['transparent']
                },
                plotOptions: {
                    pie: {
                        donut: {
                            size: '70%'
                        }
                    }
                },
                dataLabels: {
                    enabled: true,
                    formatter: function (val, opts) {
                        return  val.toFixed(2) + "%";
                    }
                },
                tooltip: {
                    y: {
                        formatter: function (val) {
                            return val + " AZN";
                        }
                    }
                },
                responsive: [{
                    breakpoint: 480,
                    options: {
                        chart: {
                            width: 200
                        },
                        legend: {
                            position: 'bottom'
                        }
                    }
                }]
            };

            var chart = new ApexCharts(document.querySelector("#sales-chart"), options);
            chart.render();
        });
    </script>
}
