@using Medicloud.Models.DTO;
@model UserDTO;
<div class="navbar-custom">
    <div class="topbar container-fluid">
        <div class="d-flex align-items-center gap-lg-2 gap-1">

            <!-- Topbar Brand Logo -->
            <div class="logo-topbar">
                <!-- Logo light -->
                <a href="#" class="logo-light">
                    <span class="logo-lg">
                        <img src="/assets/images/mc_logo_inline.svg" alt="logo" style="object-fit:cover; height:60px">
                    </span>
                    <span class="logo-sm">
                        <img src="/assets/images/mc_logo.svg" alt="small logo" style="object-fit:cover; height:40px">
                    </span>
                </a>

                <!-- Logo Dark -->
                <a href="#" class="logo-dark">
                    <span class="logo-lg">
                        <img src="/assets/images/mc_logo_inline.svg" alt="logo" style="object-fit:cover; height:60px">
                    </span>
                    <span class="logo-sm">
                        <img src="/assets/images/mc_logo.svg" alt="small logo" style="object-fit:cover; height:50px">
                    </span>
                </a>
            </div>

            <!-- Sidebar Menu Toggle Button -->
            <button class="button-toggle-menu">
                <i class="mdi mdi-menu"></i>
            </button>

            <!-- Horizontal Menu Toggle Button -->
            <button class="navbar-toggle" data-bs-toggle="collapse" data-bs-target="#topnav-menu-content">
                <div class="lines">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </button>

            <!-- Topbar Search Form -->
            <!--<div class="app-search dropdown d-none d-lg-block">
                <form>
                    <div class="input-group">
                        <input type="search" class="form-control dropdown-toggle" placeholder="Search..." id="top-search">
                        <span class="mdi mdi-magnify search-icon"></span>
                        <button class="input-group-text btn btn-primary" type="submit">Search</button>
                    </div>
                </form>

                <div class="dropdown-menu dropdown-menu-animated dropdown-lg" id="search-dropdown">-->
                    <!-- item-->
                    <!--<div class="dropdown-header noti-title">
                        <h5 class="text-overflow mb-2">Found <span class="text-danger">17</span> results</h5>
                    </div>-->

                    <!-- item-->
                    <!--<a href="javascript:void(0);" class="dropdown-item notify-item">
                        <i class="uil-notes font-16 me-1"></i>
                        <span>Analytics Report</span>
                    </a>-->

                    <!-- item-->
                    <!--<a href="javascript:void(0);" class="dropdown-item notify-item">
                        <i class="uil-life-ring font-16 me-1"></i>
                        <span>How can I help you?</span>
                    </a>-->

                    <!-- item-->
                    <!--<a href="javascript:void(0);" class="dropdown-item notify-item">
                        <i class="uil-cog font-16 me-1"></i>
                        <span>User profile settings</span>
                    </a>-->

                    <!-- item-->
                    <!--<div class="dropdown-header noti-title">
                        <h6 class="text-overflow mb-2 text-uppercase">Users</h6>
                    </div>

                    <div class="notification-list">-->
                        <!-- item-->
                        <!--<a href="javascript:void(0);" class="dropdown-item notify-item">
                            <div class="d-flex">
                                <img class="d-flex me-2 rounded-circle" src="assets/images/users/avatar-2.jpg" alt="Generic placeholder image" height="32">
                                <div class="w-100">
                                    <h5 class="m-0 font-14">Erwin Brown</h5>
                                    <span class="font-12 mb-0">UI Designer</span>
                                </div>
                            </div>
                        </a>-->

                        <!-- item-->
                        <!--<a href="javascript:void(0);" class="dropdown-item notify-item">
                            <div class="d-flex">
                                <img class="d-flex me-2 rounded-circle" src="assets/images/users/avatar-5.jpg" alt="Generic placeholder image" height="32">
                                <div class="w-100">
                                    <h5 class="m-0 font-14">Jacob Deo</h5>
                                    <span class="font-12 mb-0">Developer</span>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>-->
        </div>
        <ul class="topbar-menu d-flex align-items-center gap-3">
            <li class="dropdown d-lg-none">
                <a class="nav-link dropdown-toggle arrow-none" data-bs-toggle="dropdown" href="index.html#" role="button" aria-haspopup="false" aria-expanded="false">
                    <i class="ri-search-line font-22"></i>
                </a>
                <div class="dropdown-menu dropdown-menu-animated dropdown-lg p-0">
                    <form class="p-3">
                        <input type="search" class="form-control" placeholder="Axtar ..." aria-label="Recipient's username">
                    </form>
                </div>
            </li>

            <!--<li class="dropdown">
                <a class="nav-link dropdown-toggle arrow-none" data-bs-toggle="dropdown" href="index.html#" role="button" aria-haspopup="false" aria-expanded="false">
                    <img src="/assets/images/flags/Azerbaijan.svg" alt="user-image" class="me-0 me-sm-1" height="12">
                    <span class="align-middle d-none d-lg-inline-block">Azərbaycan</span> <i class="mdi mdi-chevron-down d-none d-sm-inline-block align-middle"></i>
                </a>
                <div class="dropdown-menu dropdown-menu-end dropdown-menu-animated">-->
            <!-- item-->
            <!--<a href="javascript:void(0);" class="dropdown-item">
                <img src="/assets/images/flags/germany.jpg" alt="user-image" class="me-1" height="12"> <span class="align-middle">German</span>
            </a>-->
            <!-- item-->
            <!--<a href="javascript:void(0);" class="dropdown-item">
                <img src="/assets/images/flags/italy.jpg" alt="user-image" class="me-1" height="12"> <span class="align-middle">Italian</span>
            </a>-->
            <!-- item-->
            <!--<a href="javascript:void(0);" class="dropdown-item">
                <img src="/assets/images/flags/spain.jpg" alt="user-image" class="me-1" height="12"> <span class="align-middle">Spanish</span>
            </a>-->
            <!-- item-->
            <!--<a href="javascript:void(0);" class="dropdown-item">
                        <img src="/assets/images/flags/russia.jpg" alt="user-image" class="me-1" height="12"> <span class="align-middle">Russian</span>
                    </a>

                </div>
            </li>-->
            <li class="dropdown">
                <a class="nav-link dropdown-toggle arrow-none" data-bs-toggle="dropdown" href="index.html#" role="button" aria-haspopup="false" aria-expanded="false">
                    @*<img src="/assets/images/flags/Azerbaijan.svg" alt="user-image" class="me-0 me-sm-1" height="12">*@
                    <span class="align-middle d-inline"> @ViewBag.SelectedOrganization</span>
                    <i class="mdi mdi-chevron-down d-inline align-middle"></i>
                </a>
                <div class="dropdown-menu dropdown-menu-end dropdown-menu-animated">
                    @foreach (var item in Model.organizations)
                    {
                        <a class="dropdown-item" id="@item.organizationID" onclick="UpdateOrganizationSelection('@item.organizationID','@item.organizationName')">@item.organizationName</a>
                    }
                    <!-- Dynamically populated items will be added here -->
                </div>
            </li>

            <!--<li class="dropdown d-none d-sm-inline-block">
            <a class="nav-link dropdown-toggle arrow-none" data-bs-toggle="dropdown" href="index.html#" role="button" aria-haspopup="false" aria-expanded="false">
                <i class="ri-apps-2-line font-22"></i>
            </a>
            <div class="dropdown-menu dropdown-menu-end dropdown-menu-animated dropdown-lg p-0">

                <div class="p-2">
                    <div class="row g-0">
                        <div class="col">
                            <a class="dropdown-icon-item" href="index.html#">
                                <img src="/assets/images/brands/slack.png" alt="slack">
                                <span>Slack</span>
                            </a>
                        </div>
                        <div class="col">
                            <a class="dropdown-icon-item" href="index.html#">
                                <img src="/assets/images/brands/github.png" alt="Github">
                                <span>GitHub</span>
                            </a>
                        </div>
                        <div class="col">
                            <a class="dropdown-icon-item" href="index.html#">
                                <img src="/assets/images/brands/dribbble.png" alt="dribbble">
                                <span>Dribbble</span>
                            </a>
                        </div>
                    </div>

                    <div class="row g-0">
                        <div class="col">
                            <a class="dropdown-icon-item" href="index.html#">
                                <img src="/assets/images/brands/bitbucket.png" alt="bitbucket">
                                <span>Bitbucket</span>
                            </a>
                        </div>
                        <div class="col">
                            <a class="dropdown-icon-item" href="index.html#">
                                <img src="/assets/images/brands/dropbox.png" alt="dropbox">
                                <span>Dropbox</span>
                            </a>
                        </div>
                        <div class="col">
                            <a class="dropdown-icon-item" href="index.html#">
                                <img src="/assets/images/brands/g-suite.png" alt="G Suite">
                                <span>G Suite</span>
                            </a>
                        </div>
                    </div>-->
            <!-- end row-->
            <!--</div>

                </div>
            </li>-->

            <li class="d-none d-sm-inline-block">
                <a class="nav-link" data-bs-toggle="offcanvas" href="index.html#theme-settings-offcanvas">
                    <i class="ri-settings-3-line font-22"></i>
                </a>
            </li>

            <li class="d-none d-sm-inline-block">
                <div class="nav-link" id="light-dark-mode" data-bs-toggle="tooltip" data-bs-placement="left" title="Rejim">
                    <i class="ri-moon-line font-22"></i>
                </div>
            </li>


            <li class="d-none d-md-inline-block">
                <a class="nav-link" href="" data-toggle="fullscreen">
                    <i class="ri-fullscreen-line font-22"></i>
                </a>
            </li>

            <li class="dropdown">
                <a class="nav-link dropdown-toggle arrow-none nav-user px-2" data-bs-toggle="dropdown" href="index.html#" role="button" aria-haspopup="false" aria-expanded="false">
                    <span class="account-user-avatar">
                        @{
                            var imageSrc = "/res/user.svg";
                            if (!string.IsNullOrEmpty(Model.personal.imagePath))
                            {
                                var filePath = Model.personal.imagePath.Replace("\\", "/");
                                imageSrc = filePath;

                            }
                        }
                        <img src="@imageSrc" alt="user-image" style="object-fit:cover;" width="32" class="rounded-circle">
                    </span>
                    <span class="d-lg-flex flex-column gap-1 d-none">
                        <h5 class="my-0 fullName">@Model.personal.name @Model.personal.surname</h5>
                        <h6 class="my-0 fw-normal userType">

                            @{



                                var roleIds = Model.Roles.Select(a => a.id);
                                if (roleIds.Contains(2))
                                {
                                    @:Admin
                                }
                                else if (roleIds.Contains(3))
                                {

                                    @:İnzibatçı

                                }
                                else if (roleIds.Contains(4))
                                {

                                    @:Həkim

                                }
                                else if (roleIds.Contains(6))
                                {
                                    @:İstifadəçi
                                }
                            }
                        </h6>
                    </span>
                </a>
                <div class="dropdown-menu dropdown-menu-end dropdown-menu-animated profile-dropdown">
                    <!-- item-->
                    <div class=" dropdown-header noti-title">
                        <h6 class="text-overflow m-0">Xoş Gəlmişsiniz !</h6>
                    </div>
                    <!-- item-->
                    <a  asp-area="default" asp-action="Index" asp-controller="profile" class="dropdown-item">
                        <i class="mdi mdi-account-circle me-1"></i>
                        <span>Hesabım</span>
                    </a>
                    <!-- item-->
                    <!--<a href="javascript:void(0);" class="dropdown-item">
                        <i class="mdi mdi-account-edit me-1"></i>
                        <span>Settings</span>
                    </a>-->
                    <!-- item-->
                    <!--<a href="javascript:void(0);" class="dropdown-item">
                        <i class="mdi mdi-lifebuoy me-1"></i>
                        <span>Support</span>
                    </a>-->
                    <!-- item-->
                    <!--<a href="javascript:void(0);" class="dropdown-item">
                        <i class="mdi mdi-lock-outline me-1"></i>
                        <span>Lock Screen</span>
                    </a>-->
                    <!-- item-->
                    <button onclick="logout();" class="dropdown-item">
                        <i class="mdi mdi-logout me-1"></i>
                        <span>Çıxış</span>
                    </button>
                </div>
            </li>
        </ul>
    </div>
</div>

<script>function UpdateOrganizationSelection(id, name) {
        localStorage.setItem('selectedOrganization', id);
        localStorage.setItem('selectedOrganizationName', name);
        //$selectedOrganizationName.text(name);
        //$organizationLogo.text(organization.organizationName);

        saveUserSetting("Medicloud_organizationID", id)
            .then(() => {
                // After saving selectedOrganization, save the next setting
                return saveUserSetting("Medicloud_organizationName", name);
            })
            .then(() => {
                // After all settings are saved, refresh the page
                console.log('All settings saved, refreshing page.');
                window.location.reload();
            })
            .fail((error) => {
                // Handle any errors that occurred during the save operations
                console.error("Error saving settings: ", error);
            });


    }</script>
