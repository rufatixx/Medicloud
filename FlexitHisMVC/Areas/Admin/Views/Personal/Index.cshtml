@model Medicloud.Areas.Admin.Model.PersonalPageDTO

@{
    ViewData["Title"] = "- Personal";

    var userId = User.FindFirst("ID")?.Value;
    var currentUser = Model.personalList.FirstOrDefault(p => p.ID.ToString() == userId);
}


<div class="row my-2">
    <div class="col-12">

        <div class="d-flex justify-content-between align-items-center">
            <h4 class="mb-0">Personal</h4>
            <button type="button" class="btn btn-primary" onclick="$('#addPersonal').modal('show')">
                + Əlavə et
            </button>
        </div>

    </div>
</div>

<!-- ===================================
     MAIN CONTENT
     =================================== -->
<!-- Main Content -->
<div class="row">
    <!-- LEFT COLUMN: Filter + Personal List -->
    <div class="col-md-3 mb-3">
        <div class="card shadow-sm h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <strong>Personal siyahısı</strong>
                <!-- Onchange => filterPersonalList() -->
                <select class="form-select w-auto" required id="depIsActiveFilter" onchange="filterPersonalList()">
                    <option value="1">Aktiv</option>
                    <option value="0">Deaktiv</option>
                </select>
            </div>

            <!-- We'll remove the server-side foreach -->
            <div class="card-header bg-light">
                <div class="row">
                    <div class="col-6"><strong>Adı</strong></div>
                    <div class="col-6 text-end"><strong>İxtisas</strong></div>
                </div>
            </div>

            <!-- This .list-group will be dynamically populated by JS -->
            <div class="list-group list-group-flush" style="max-height: 50vh; overflow-y: auto"
                 id="depTypesInBuilding">
            </div>
        </div>
    </div>

    <!-- RIGHT: PERSONAL DETAILS -->
    <div class="col-md-9">
        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <ul class="nav nav-tabs card-header-tabs">
                    <li class="nav-item">
                        <a class="nav-link active" id="generalSettingsButton" onclick="settingsBoxClicked(1)">
                            Ümumi
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="positionSettingsButton" onclick="settingsBoxClicked(2)">
                            Vəzifə yeri
                        </a>
                    </li>
                </ul>
            </div>

            <div class="card-body">
                <!-- GENERAL SETTINGS -->
                <div id="generalSettings">
                    <ul class="nav nav-pills mb-3">
                        <li class="nav-item">
                            <span class="nav-link active">Əsas məlumatlar</span>
                        </li>
                    </ul>

                    <div class="row mb-3">
                        <div class="col-md-9">
                            <!-- Row 1: Reg Code, Name, Surname -->
                            <div class="mb-3">
                                <div class="row gx-2 gy-2">
                                    <div class="col-md-4">
                                        <label class="form-label">Registr kodu</label>
                                        <input type="text" class="form-control" id="reqCode"
                                               value="@currentUser.ID" disabled />
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Ad</label>
                                        <input type="text" class="form-control" id="name"
                                               value="@currentUser.name" placeholder="Ad" />
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Soyad</label>
                                        <input type="text" class="form-control" id="surname"
                                               value="@currentUser.surname" placeholder="Soyad" />
                                    </div>
                                </div>
                            </div>

                            <!-- Row 2: Father, PassportSerialNum, Fin -->
                            <div class="mb-3">
                                <div class="row gx-2 gy-2">
                                    <div class="col-md-4">
                                        <label class="form-label">Ata adı</label>
                                        <input type="text" class="form-control" id="father"
                                               value="@currentUser.father" placeholder="Ata adı" />
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">ŞV Seriyası</label>
                                        <input type="text" class="form-control" id="passportSerialNum"
                                               value="@currentUser.passportSerialNum"
                                               placeholder="ŞV Seriyası" />
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">ŞV FİN</label>
                                        <input type="text" class="form-control" id="passportFin"
                                               value="@currentUser.fin" placeholder="FİN" />
                                    </div>
                                </div>
                            </div>

                            <!-- Row 3: Birthday, Speciality, Mobile -->
                            <div class="mb-3">
                                <div class="row gx-2 gy-2">
                                    <div class="col-md-4">
                                        <label class="form-label">Doğum tarixi</label>
                                        <input type="date" class="form-control" id="bDate"
                                               value="@currentUser.passportSerialNum" />
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">İxtisas</label>
                                        <select class="form-select" id="speciality">
                                            @foreach (var item in Model.specialityList)
                                            {
                                                if (currentUser.speciality.id == item.id)
                                                {
                                                    <option value="@item.id" selected data-foo="@item.id">@item.name</option>
                                                }
                                                else
                                                {
                                                    <option value="@item.id" data-foo="@item.id">@item.name</option>
                                                }
                                            }
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Mobil nömrə</label>
                                        <input type="text" class="form-control" id="mobile"
                                               value="@currentUser.mobile" placeholder="(050) ___ __ __" />
                                    </div>
                                </div>
                            </div>

                            <!-- Row 4: Email, Username -->
                            <div class="mb-3">
                                <div class="row gx-2 gy-2">
                                    <div class="col-md-6">
                                        <label class="form-label">E-poçt ünvanı</label>
                                        <input type="text" class="form-control" id="email"
                                               value="@currentUser.email" placeholder="e-poçt" />
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">İstifadəçi adı</label>
                                        <input type="text" class="form-control" id="username"
                                               value="@currentUser.username" placeholder="username" />
                                    </div>
                                </div>
                            </div>

                            <!-- Role Checkboxes -->
                            <div class="mb-3">
                                <div class="row gx-2 gy-2">
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="isActiveCheckBox"
                                                   @(currentUser.roles?.Count() > 0 ? "checked" : "") />
                                            <label class="form-check-label">Aktiv</label>
                                        </div>
                                    </div>

                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="isDrCheckBox"
                                                   @(currentUser.roles.Select(r => r.id).Contains(4) ? "checked" : "") />
                                            <label class="form-check-label">Həkim</label>
                                        </div>
                                    </div>

                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="isUserCheckBox"
                                                   @(currentUser.roles.Select(r => r.id).Contains(6) ? "checked" : "") />
                                            <label class="form-check-label">İstifadəçi</label>
                                        </div>
                                    </div>

                                    @if (currentUser.roles.Select(r => r.id).Contains(2))
                                    {
                                        <div class="col-md-3">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="isAdminCheckBox"
                                                       checked />
                                                <label class="form-check-label">Admin</label>
                                            </div>
                                        </div>
                                    }

                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="isManagerCheckBox"
                                                   @(currentUser.roles.Select(r => r.id).Contains(3) ? "checked" : "") />
                                            <label class="form-check-label">İnzibatçı</label>
                                        </div>
                                    </div>

                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="isCashierCheckBox"
                                                   @(currentUser.roles.Select(r => r.id).Contains(5) ? "checked" : "") />
                                            <label class="form-check-label">Kassir</label>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="isReceptionistCheckBox"
                                                   @(currentUser.roles.Select(r => r.id).Contains(7) ? "checked" : "") />
                                            <label class="form-check-label">Qeydiyyatcı</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- PROFILE IMAGE & ACTIONS -->
                        <div class="col-md-3">
                            @{
                                var imageSrc = "/res/user.svg";
                                if (!string.IsNullOrEmpty(currentUser.imagePath as string))
                                {
                                    var filePath = currentUser.imagePath.Replace("\\", "/");
                                    imageSrc = filePath;
                                }
                            }
                            <div class="text-center mb-3">
                                <img id="profilePic" src="@imageSrc" width="86" style="object-fit:cover;"
                                     alt="Profile" class="rounded-circle img-fluid mb-2" />
                            </div>
                            <div class="mb-2">
                                <button type="button" class="btn btn-secondary w-100 shadow"
                                        onclick="$('#passChangeModal').modal('show')">
                                    Yeni şifrə
                                </button>
                            </div>
                            <div>
                                <button type="button" class="btn btn-outline-info w-100">
                                    Rəsmi imza (Tezlikə)
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- SAVE BUTTON -->
                    <div class="border-top pt-3 text-end">
                        <button type="button" class="btn btn-info text-white" onclick="updateUser()">
                            Yadda saxla
                        </button>
                    </div>
                </div>

                <!-- POSITION SETTINGS -->
                <div id="positionSettings" style="display:none">
                    <ul class="nav nav-pills m-3 mb-4">
                        <li class="nav-item">
                            <a class="nav-link active" id="depTogle" onclick="KassaOrDepClicked(1)">Şöbələr</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="kassaTogle" onclick="KassaOrDepClicked(2)">Kassa</a>
                        </li>
                    </ul>

                    <div class="ms-3 mb-3">
                        <label class="form-label">Müəssisə</label>
                        <div class="row gx-2 gy-2">
                            <div class="col-4">
                                <div class="dropdown">
                                    <button class="btn btn-outline-dark dropdown-toggle w-100" type="button"
                                            id="userOrganizations" data-bs-toggle="dropdown"
                                            aria-haspopup="true" aria-expanded="false">
                                    </button>
                                    <div class="dropdown-menu">
                                        <h6 class="dropdown-header">Əlavə olunmuş müəssisələr</h6>
                                        <div id="userOrganizationsMenu"></div>
                                    </div>
                                </div>
                            </div>
                            @if (currentUser.roles.Select(r => r.id).Contains(3))
                            {
                                <div class="col-8">
                                    <button type="button" class="btn btn-light"
                                            onclick="$('#addOrganization').modal('show');">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                             viewBox="0 0 24 24" fill="none">
                                            <path fill-rule="evenodd" clip-rule="evenodd"
                                                  d="M15 13H13V15C13 15.55 12.55 16 12 16C11.45 16 11 15.55 11 15V13H9C8.45 13 8 12.55 8 12C8 11.45 8.45 11 9 11H11V9C11 8.45 11.45 8 12 8C12.55 8 13 8.45 13 9V11H15C15.55 11 16 11.45 16 12C16 12.55 15.55 13 15 13ZM12 2C6.486 2 2 6.486 2 12C2 17.514 6.486 22 12 22C17.514 22 22 17.514 22 12C22 6.486 17.514 2 12 2Z"
                                                  fill="#2AAEAD"></path>
                                        </svg>
                                        müəssisə əlavə et
                                    </button>
                                </div>
                            }
                        </div>
                    </div>

                    <!-- DEPARTMENTS / KASSA LISTS -->
                    <div class="row">
                        <div class="col-12">
                            <div class="card border-light mb-3" id="userDepList">
                                <div class="card-header">
                                    <div class="d-flex justify-content-end mb-2">
                                        <button type="button" class="btn btn-sm btn-dark"
                                                onclick="$('#addDepartment').modal('show');">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                 viewBox="0 0 24 24" fill="none">
                                                <path fill-rule="evenodd" clip-rule="evenodd"
                                                      d="M15 13H13V15C13 15.55 12.55 16 12 16C11.45 16 11 15.55 11 15V13H9C8.45 13 8 12.55 8 12C8 11.45 8.45 11 9 11H11V9C11 8.45 11.45 8 12 8C12.55 8 13 8.45 13 9V11H15C15.55 11 16 11.45 16 12C16 12.55 15.55 13 15 13ZM12 2C6.486 2 2 6.486 2 12C2 17.514 6.486 22 12 22C17.514 22 22 17.514 22 12C22 6.486 17.514 2 12 2Z"
                                                      fill="#2AAEAD"></path>
                                            </svg>
                                            Şöbə əlavə et
                                        </button>
                                    </div>
                                    <div class="row">
                                        <div class="col-3"><strong>Şöbənin adı</strong></div>
                                        <div class="col-2"><strong>Tipi</strong></div>
                                        <div class="col-2"><strong>Gör</strong></div>
                                        <div class="col-3"><strong>Tam kontrol</strong></div>
                                        <div class="col-2"><strong>Sil</strong></div>
                                    </div>
                                </div>
                                <div class="list-group list-group-flush" style="max-height: 30vh; overflow-y: auto"
                                     id="depsInOrganizationByUser">
                                    <!-- Filled by AJAX -->
                                </div>
                            </div>

                            <div class="card border-light" id="userKassaList" style="display:none">
                                <div class="card-header">
                                    <div class="d-flex justify-content-end mb-2">
                                        <button type="button" class="btn btn-sm btn-dark"
                                                onclick="$('#addKassa').modal('show');">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                 viewBox="0 0 24 24" fill="none">
                                                <path fill-rule="evenodd" clip-rule="evenodd"
                                                      d="M15 13H13V15C13 15.55 12.55 16 12 16C11.45 16 11 15.55 11 15V13H9C8.45 13 8 12.55 8 12C8 11.45 8.45 11 9 11H11V9C11 8.45 11.45 8 12 8C12.55 8 13 8.45 13 9V11H15C15.55 11 16 11.45 16 12C16 12.55 15.55 13 15 13ZM12 2C6.486 2 2 6.486 2 12C2 17.514 6.486 22 12 22C17.514 22 22 17.514 22 12C22 6.486 17.514 2 12 2Z"
                                                      fill="#2AAEAD"></path>
                                            </svg>
                                            Kassa əlavə et
                                        </button>
                                    </div>
                                    <div class="row">
                                        <div class="col-5"><strong>Kassa adı</strong></div>
                                        <div class="col-2"><strong>Gör</strong></div>
                                        <div class="col-3"><strong>Tam kontrol</strong></div>
                                        <div class="col-2"><strong>Sil</strong></div>
                                    </div>
                                </div>
                                <div class="list-group list-group-flush" style="max-height: 30vh; overflow-y: auto"
                                     id="kassaInOrganizationByUser">
                                    <!-- Filled by AJAX -->
                                </div>
                            </div>
                        </div><!-- col-12 -->
                    </div><!-- row -->
                </div><!-- positionSettings -->
            </div><!-- card-body -->
        </div><!-- card -->
    </div><!-- col-md-9 -->
</div><!-- row -->
<!-- ================================================== -->
<!-- ALL MODALS (Pass Change, Add Kassa, Dep, Org, etc.)
     NOW UPDATED FOR BOOTSTRAP 5
     ================================================== -->
<!-- PASS CHANGE MODAL -->
<div class="modal fade" id="passChangeModal" data-bs-backdrop="static" data-bs-keyboard="false"
     tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="btn-close" data-bs-dismiss="modal"
                        aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="text-center mb-3">
                    <img src="/res/pencil.svg" />
                </div>
                <h6 class="text-center mb-3">İstifadəçi şifrəsinin sıfırlanması</h6>
                <div class="mb-3">
                    <label class="form-label">Yeni şifrə</label>
                    <input class="form-control" placeholder="Yeni şifrə..." id="newPwd" />
                </div>
                <div class="text-center">
                    <button type="button" class="btn btn-primary" onclick="updateUserPwd()">
                        Yenilə
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ADD KASSA MODAL -->
<div class="modal fade" id="addKassa" data-bs-backdrop="static" data-bs-keyboard="false"
     tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="btn-close" data-bs-dismiss="modal"
                        aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="text-center mb-3">
                    <img src="/res/pencil.svg" />
                </div>
                <h6 class="text-center mb-3">İstifadəçiyə kassa əlavə edilməsi</h6>
                <div class="mb-3">
                    <label class="form-label">Kassalar</label>
                    <select class="form-select" required id="kassaInOrganization"></select>
                </div>
                <div class="mb-3">
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="kassaReadOnlyCheckBox">
                        <label class="form-check-label">Gör</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="kassaFullKontrolCheckBox">
                        <label class="form-check-label">Tam kontrol</label>
                    </div>
                </div>
                <div class="text-center">
                    <button type="button" class="btn btn-primary" onclick="addKassaToUser()">
                        Əlavə et
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ADD DEPARTMENT MODAL -->
<div class="modal fade" id="addDepartment" data-bs-backdrop="static" data-bs-keyboard="false"
     tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="btn-close" data-bs-dismiss="modal"
                        aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="text-center mb-3">
                    <img src="/res/pencil.svg" />
                </div>
                <h6 class="text-center mb-3">İstifadəçiyə şöbənin əlavə edilməsi</h6>
                <div class="mb-3">
                    <label class="form-label">Şöbələr</label>
                    <select class="form-select" required id="depsInOrganization"></select>
                </div>
                <div class="mb-3">
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="depReadOnlyCheckBox">
                        <label class="form-check-label">Gör</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="depFullControlCheckBox">
                        <label class="form-check-label">Tam kontrol</label>
                    </div>
                </div>
                <div class="text-center">
                    <button type="button" class="btn btn-primary" onclick="addDepartmentToUser()">
                        Əlavə et
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ADD ORGANIZATION MODAL -->
<div class="modal fade" id="addOrganization" data-bs-backdrop="static" data-bs-keyboard="false"
     tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="btn-close" data-bs-dismiss="modal"
                        aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="text-center mb-3">
                    <img src="/res/pencil.svg" />
                </div>
                <h6 class="text-center mb-3">İstifadəçiyə müəssisə əlavə edilməsi</h6>
                <div class="mb-3">
                    <label class="form-label">Müəssisələr</label>
                    <select class="form-select" required id="allOrganizations">
                        @foreach (var item in Model.organizationList)
                        {
                            <option value="@item.id">@item.organizationName</option>
                        }
                    </select>
                </div>
                <div class="text-center">
                    <button type="button" class="btn btn-primary" onclick="addOrganizationToUser()">
                        Əlavə et
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ADD PERSONAL MODAL -->
<div class="modal fade" id="addPersonal" data-bs-backdrop="static" data-bs-keyboard="false"
     tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="btn-close" data-bs-dismiss="modal"
                        aria-hidden="true"></button>
            </div>
            <div class="modal-body">
                <form id="addPersonalForm" class="needs-validation container" novalidate>
                    <div class="row">
                        <div class="col-md-12 mb-3 text-center">
                            <img src="/res/user.svg" />
                            <h3 class="mt-3">Personal əlavə edilməsi</h3>
                        </div>

                        <!-- Ad, Soyad -->
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Adı</label>
                            <input type="text" class="form-control" required id="newUserName"
                                   placeholder="Ad" />
                            <div class="valid-feedback">Əla!</div>
                            <div class="invalid-feedback">Boşluğu doldurun.</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Soyadı</label>
                            <input type="text" class="form-control" required id="newUserSurname"
                                   placeholder="Soyad" />
                            <div class="valid-feedback">Əla!</div>
                            <div class="invalid-feedback">Boşluğu doldurun.</div>
                        </div>

                        <!-- Father, BDate -->
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Ata adı</label>
                            <input type="text" class="form-control" required id="newUserFather"
                                   placeholder="Ata adı" />
                            <div class="valid-feedback">Əla!</div>
                            <div class="invalid-feedback">Boşluğu doldurun.</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Doğum tarixi</label>
                            <input type="date" class="form-control" required id="newUserBDate" />
                            <div class="valid-feedback">Əla!</div>
                            <div class="invalid-feedback">Boşluğu doldurun.</div>
                        </div>

                        <!-- PassportSerialNo, Fin -->
                        <div class="col-md-6 mb-3">
                            <label class="form-label">ŞV seriyası</label>
                            <input type="text" class="form-control" required id="newUserPassportSerialNo"
                                   placeholder="ŞV seriyası" />
                            <div class="valid-feedback">Əla!</div>
                            <div class="invalid-feedback">Boşluğu doldurun.</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Fin No</label>
                            <input type="text" class="form-control" required id="newUserFin"
                                   placeholder="FIN" />
                            <div class="valid-feedback">Əla!</div>
                            <div class="invalid-feedback">Boşluğu doldurun.</div>
                        </div>

                        <!-- Phone, Email -->
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Mobil nömrə</label>
                            <input type="text" class="form-control" required id="newUserMobile"
                                   placeholder="(050) ___ __ __" />
                            <div class="valid-feedback">Əla!</div>
                            <div class="invalid-feedback">Boşluğu doldurun.</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Elektron poçt ünvanı</label>
                            <input type="text" class="form-control" required id="newUserEmail"
                                   placeholder="E-poçt" />
                            <div class="valid-feedback">Əla!</div>
                            <div class="invalid-feedback">Boşluğu doldurun.</div>
                        </div>

                        <!-- Roles -->
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Vəzifə</label>
                            <div class="dropdown">
                                <button class="btn btn-outline-dark dropdown-toggle w-100"
                                        type="button" id="rolesDropdownMenuButton"
                                        data-bs-toggle="dropdown" aria-expanded="false">
                                    Seçin
                                </button>
                                <ul class="dropdown-menu" id="rolesSelectDropdownMenu"
                                    aria-labelledby="rolesDropdownMenuButton"
                                    style="min-width: 200px;">
                                    <li>
                                        <label class="dropdown-item">
                                            <input type="checkbox" value="3"
                                                   class="form-check-input me-2"> İnzibatçı
                                        </label>
                                    </li>
                                    <li>
                                        <label class="dropdown-item">
                                            <input type="checkbox" value="4"
                                                   class="form-check-input me-2"> Həkim
                                        </label>
                                    </li>
                                    <li>
                                        <label class="dropdown-item">
                                            <input type="checkbox" value="5"
                                                   class="form-check-input me-2"> Kassir
                                        </label>
                                    </li>
                                    <li>
                                        <label class="dropdown-item">
                                            <input type="checkbox" value="7"
                                                   class="form-check-input me-2"> Qeydiyyatcı
                                        </label>
                                    </li>
                                    <li>
                                        <label class="dropdown-item">
                                            <input type="checkbox" value="6" checked
                                                   class="form-check-input me-2"> İstifadəçi
                                        </label>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <!-- Speciality (only shown if '4' => Həkim) -->
                        <div class="col-md-6 mb-3" id="newUserSpecialityContent" style="display:none;">
                            <label class="form-label">İxtisas</label>
                            <div class="dropdown">
                                <button type="button" class="btn btn-outline-dark dropdown-toggle w-100"
                                        data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <span class="justify-content-end newUserSpeciality">Seçin...</span>
                                </button>
                                <div class="dropdown-menu">
                                    @foreach (var item in Model.specialityList)
                                    {
                                        <a class="dropdown-item" id="@item.id"
                                           onclick="$('.newUserSpeciality').text('@item.name'); $('.newUserSpeciality').attr('id','@item.id');">
                                            @item.name
                                        </a>
                                    }
                                </div>
                            </div>
                        </div>

                        <!-- Username & Password -->
                        <div class="col-md-6 mb-3">
                            <label class="form-label">İstifadəçi adı</label>
                            <input type="text" class="form-control" id="newUserUsername"
                                   placeholder="İstifadəçi adı" />
                            <div class="valid-feedback">Əla!</div>
                            <div class="invalid-feedback">Boşluğu doldurun.</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Şifrə</label>
                            <input type="text" class="form-control" id="newUserPwd"
                                   placeholder="Şifrə" required />
                            <div class="valid-feedback">Əla!</div>
                            <div class="invalid-feedback">Boşluğu doldurun.</div>
                        </div>

                        <div class="col-md-12 text-center mt-3">
                            <button type="button" class="btn btn-primary" onclick="addPersonal()">
                                Əlavə et
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- SYSTEM & WARNING MODALS -->
<div class="modal fade" id="systemModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="systemModalTitle"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"
                        aria-label="Close"></button>
            </div>
            <div class="modal-body" id="systemModalText"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="systemModalBtn"
                        data-bs-dismiss="modal">
                    OK
                </button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="warningModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Warning</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"
                        aria-label="Close"></button>
            </div>
            <div class="modal-body" id="warningText"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary"
                        data-bs-dismiss="modal">
                    Bağla
                </button>
            </div>
        </div>
    </div>
</div>

<!-- =========================================
     CUSTOM STYLES
     ========================================= -->
<style>
    .nav-pills .nav-link.active {
        border-radius: 2rem;
        background-color: #2AAEAD;
        color: #fff;
    }

    .nav-pills .nav-link {
        margin: 0.25rem !important;
        border-radius: 2rem;
        border: 1px solid #dee2e6 !important;
        color: #2AAEAD;
    }
    /* Example: override .selectedDepCard if you want special styling */
    .selectedDepCard {
        border: 1px solid #dee2e6;
    }
</style>




<!-- ================================================== -->
<!-- SCRIPTS SECTION -->
<!-- ================================================== -->
@section Scripts {
    <script>
        var selectedOrganization;
        var selectedPersonalID = @Model.personalList[0].ID;
        getOrganizationsByUser(selectedPersonalID);
        var newPersonalIsUser = 0;
                var allPersonals = @Html.Raw(Json.Serialize(Model.personalList));


        // On page load, populate the list with the default filter ("Aktiv")
        $(document).ready(function () {
            filterPersonalList();
        });

        function filterPersonalList() {
            // "1" => active, "0" => inactive
            var filterVal = $("#depIsActiveFilter").val();
            // Clear out the existing items
            $("#depTypesInBuilding").empty();

            // Loop through allPersonals
            allPersonals.forEach(function (item) {
                // Determine if item is "active" or "inactive"
                // We'll say active if item.roles.length > 0
                var isActive = (item.roles && item.roles.length > 0) ? 1 : 0;
                // Compare to the filter
                if (isActive.toString() === filterVal) {
                    // Build the HTML
                    var specialistName = item.speciality ? item.speciality.name : "";
                    var rowHtml = `
                        <div class="list-group-item list-group-item-action personal-list"
                             onclick='personalClicked(this, ${JSON.stringify(item)})'>
                            <div class="row">
                                <div class="col-6">${item.name} ${item.surname}</div>
                                <div class="col-6 text-end">${specialistName}</div>
                            </div>
                        </div>
                    `;
                    // Append to the list
                    $("#depTypesInBuilding").append(rowHtml);
                }
            });
        }


        function checkIsUserBox(state) {
            if ($(state).is(':checked')) {
                $("#newUserUsername").prop('required', true);
                $("#newUserPwd").prop('required', true);
                newPersonalIsUser = 1;
            } else {
                newPersonalIsUser = 0;
                $("#newUserUsername").prop('required', false);
                $("#newUserPwd").prop('required', false);
            }
        }

        function updateUser() {
            var userSpecialityOption = $("#speciality").find('option:selected');
            var userSpecialityID = userSpecialityOption.data('foo');
            var userID = $("#reqCode").val();
            var bDate = $("#bDate").val();
            var mobile = $("#mobile").val();
            var email = $("#email").val();
            var username = $("#username").val();
            var name = $("#name").val();
            var surname = $("#surname").val();
            var father = $("#father").val();
            var passportSerialNum = $("#passportSerialNum").val();
            var fin = $("#passportFin").val();
            var isActiveCheckBox = $("#isActiveCheckBox").prop('checked') ? 1 : 0;
            var selectedValues = [];
            if ($("#isDrCheckBox").prop('checked')) { selectedValues.push(4); }
            if ($("#isUserCheckBox").prop('checked')) { selectedValues.push(6); }
            if ($("#isAdminCheckBox").prop('checked')) { selectedValues.push(2); }
            if ($("#isManagerCheckBox").prop('checked')) { selectedValues.push(3); }
            if ($("#isCashierCheckBox").prop('checked')) { selectedValues.push(5); }
            if ($("#isReceptionistCheckBox").prop('checked')) { selectedValues.push(7); }

            $.post("@Url.Action("UpdateUser", "Personal", new { area = "Admin" })",
                { userID: userID, mobile: mobile, email: email, username: username, bDate: bDate, passportSerialNum: passportSerialNum, fin: fin, specialityID: userSpecialityID, name: name, surname: surname, father: father, isActive: isActiveCheckBox, roleIds: selectedValues },
                function (data) {
                    $('#systemModal').modal('hide');
                    $('#warningModal').modal('show');
                    $('#warningText').text(data > 0 ? 'Məlumatlar yeniləndi' : 'Məlumatlar yenilənmədi');
                }
            );
        }

        function updateUserPwd() {
            var userID = $("#reqCode").val();
            var pwd = $("#newPwd").val();
            $.post("@Url.Action("UpdateUserPwd", "Personal", new { area = "Admin" })",
                { userID: userID, pwd: pwd },
                function (data) {
                    $('#systemModal').modal('hide');
                    $('#warningModal').modal('show');
                    $('#warningText').text(data > 0 ? 'Şifrə sıfırlandı' : 'Məlumatlar yenilənmədi');
                }
            );
        }

        function getOrganizationsByUser(personalID) {
            $.get("@Url.Action("OrganizationsByUser", "Personal", new { area = "Admin" })",
                { personalID: selectedPersonalID },
                function (data) {
                    if (data.length > 0) {
                        $("#userOrganizations").text(data[0].organizationName).val(data[0].organizationID);
                        selectedOrganization = data[0].organizationID;
                        $("#userOrganizationsMenu").empty();
                        $.each(data, function () {
                            $("#userOrganizationsMenu").append($(`
                                <div class="row m-1">
                                    <div class="col-9">
                                        <a class="dropdown-item" id=${this.id} onclick="$('#userOrganizations').text('${this.organizationName}').val('${this.organizationID}'); getDepartmentsByOrganization(${this.organizationID}); getKassaByOrganization(); getUserKassaByOrganization(); getUserDepsByOrganization();">
                                            ${this.organizationName}
                                        </a>
                                    </div>
                                    <div class="col-3">
                                        <button class='btn text-danger' onclick='removeOrganizationFromUser(${this.organizationID});'>Sil</button>
                                    </div>
                                </div>
                            `));
                        });
                        getDepartmentsByOrganization($('#userOrganizations').val());
                        getUserDepsByOrganization();
                        getUserKassaByOrganization();
                        getKassaByOrganization();
                    } else {
                        selectedOrganization = 0;
                        $("#userOrganizations").text("Əlavə edin");
                        $("#userOrganizationsMenu").empty();
                        $("#depsInOrganizationByUser").empty().append($(`<div class='text-center m-3'><img style='height:100px' src="/res/empty.png"/><br><h2 class='mt-3'>Boşdur</h2></div>`));
                    }
                }
            );
        }

        function getDepartmentsByOrganization(organizationID) {
            $("#depsInOrganization").empty();
            $.get("@Url.Action("DepartmentsByOrganization", "Personal", new { area = "Admin" })",
                { organizationID: organizationID },
                function (data) {
                    if (data.length > 0) {
                        $.each(data, function () {
                            $("#depsInOrganization").append($(`
                                <option id='${this.id}'>${this.name} - ${this.type}</option>
                            `));
                        });
                    }
                }
            );
        }

        function getKassaByOrganization() {
            $("#kassaInOrganization").empty();
            $.get("@Url.Action("GetAllKassaByOrganization", "Personal", new { area = "Admin" })",
                { organizationID: $('#userOrganizations').val() },
                function (data) {
                    if (data.length > 0) {
                        $.each(data, function () {
                            $("#kassaInOrganization").append($(`
                                <option id='${this.id}'>${this.name}</option>
                            `));
                        });
                    }
                }
            );
        }

        function personalClicked(component, obj) {

            selectedPersonalID = obj.id;
            $('.personal-list').removeClass('active');
            $(component).addClass('active');
            $("#reqCode").val(obj.id);
            var today = new Date(obj.bDate).toISOString().split('T')[0];
            $("#bDate").val(today);
            $("#speciality").val(obj.speciality.id);
            $("#mobile").val(obj.mobile);
            $("#email").val(obj.email);
            $("#father").val(obj.father);
            $("#name").val(obj.name);
            $("#surname").val(obj.surname);
            $("#passportSerialNum").val(obj.passportSerialNum);
            $("#passportFin").val(obj.fin);
            $("#username").val(obj.username);
            var imagePath = obj.imagePath && obj.imagePath.trim() !== "" ? obj.imagePath : "/res/user.svg";
            $("#profilePic").attr("src", imagePath);
            var roles = obj.roles;
            var roleIds = roles.map(r => r.id);
            $("#isActiveCheckBox").prop('checked', roleIds.length > 0);
            updateCheckBoxStatus(2, "#isAdminCheckBox", roleIds);
            updateCheckBoxStatus(3, "#isManagerCheckBox", roleIds);
            updateCheckBoxStatus(4, "#isDrCheckBox", roleIds);
            updateCheckBoxStatus(5, "#isCashierCheckBox", roleIds);
            updateCheckBoxStatus(6, "#isUserCheckBox", roleIds);
            updateCheckBoxStatus(7, "#isReceptionistCheckBox", roleIds);
            getOrganizationsByUser(selectedPersonalID);
        }

        function updateCheckBoxStatus(statusId, checkboxId, statusList) {
            $(checkboxId).prop('checked', statusList.includes(statusId));
        }

        function getUserDepsByOrganization() {
            $("#depsInOrganizationByUser").empty();
            var userDeps;
            $.get("@Url.Action("GetDepartmentsByUser", "Personal", new { area = "Admin" })",
                { userID: $("#reqCode").val() },
                function (data) {
                    if (data.length > 0) {
                        userDeps = data;
                        $.get("/Admin/Personal/DepartmentsByOrganization",
                            { organizationID: $("#userOrganizations").val() },
                            function (data) {
                                if (data.length > 0) {
                                    var depsByOrganization = data;
                                    for (let a = 0; a < userDeps.length; a++) {
                                        for (let i = 0; i < depsByOrganization.length; i++) {
                                            if (depsByOrganization[i].id == userDeps[a].depID) {
                                                var readOnlyCheckBox = userDeps[a].readOnly > 0 ?
                                                    '<input class="me-1" type="checkbox" checked onclick="return false">' :
                                                    '<input class="me-1" type="checkbox" onclick="return false">';
                                                var fullAccessCheckBox = userDeps[a].fullAccess > 0 ?
                                                    '<input class="me-1" type="checkbox" checked onclick="return false">' :
                                                    '<input class="me-1" type="checkbox" onclick="return false">';
                                                $("#depsInOrganizationByUser").append($(`
                                                    <div class="list-group-item list-group-item-action dep-list" id=${depsByOrganization[i].id}>
                                                        <div class="row">
                                                            <div class="col-3">${depsByOrganization[i].name}</div>
                                                            <div class="col-2">${depsByOrganization[i].type}</div>
                                                            <div class="col-2">${readOnlyCheckBox}</div>
                                                            <div class="col-3">${fullAccessCheckBox}</div>
                                                            <div class="col-2">
                                                                <a class='text-danger' onclick='removeDepFromUser(${depsByOrganization[i].id});'>Sil</a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                `));
                                            }
                                        }
                                    }
                                } else {
                                    $("#depsInOrganizationByUser").empty().append($(`<div class='text-center m-3'><img style='height:100px' src="/res/empty.png"/><br><h2 class='mt-3'>Boşdur</h2></div>`));
                                }
                            }
                        );
                    } else {
                        $("#depsInOrganizationByUser").empty().append($(`<div class='text-center m-3'><img style='height:100px' src="/res/empty.png"/><br><h2 class='mt-3'>Boşdur</h2></div>`));
                    }
                }
            );
        }

        function getUserKassaByOrganization() {
            $("#kassaInOrganizationByUser").empty();
            $.get("@Url.Action("GetUserKassaByOrganization", "Personal", new { area = "Admin" })",
                { organizationID: $("#userOrganizations").val(), userID: $("#reqCode").val() },
                function (data) {
                    if (data.length > 0) {
                        $.each(data, function () {
                            var readOnlyCheckBox = this.readOnly > 0 ?
                                '<input class="me-1" type="checkbox" checked onclick="return false">' :
                                '<input class="me-1" type="checkbox" onclick="return false">';
                            var fullAccessCheckBox = this.fullAccess > 0 ?
                                '<input class="me-1" type="checkbox" checked onclick="return false">' :
                                '<input class="me-1" type="checkbox" onclick="return false">';
                            $("#kassaInOrganizationByUser").append($(`
                                <div class="list-group-item list-group-item-action kassa-list" id='${this.id}'>
                                    <div class="row">
                                        <div class="col-5">${this.name}</div>
                                        <div class="col-2">${readOnlyCheckBox}</div>
                                        <div class="col-3">${fullAccessCheckBox}</div>
                                        <div class="col-2">
                                            <a class='text-danger' onclick='removeKassaFromUser(${this.kassaID});'>Sil</a>
                                        </div>
                                    </div>
                                </div>
                            `));
                        });
                    } else {
                        $("#kassaInOrganizationByUser").empty().append($(`<div class='text-center m-3'><img style='height:100px' src="/res/empty.png"/><br><h2 class='mt-3'>Boşdur</h2></div>`));
                    }
                }
            );
        }

        function settingsBoxClicked(box) {
            switch (box) {
                case 1:
                    $('#positionSettings').hide();
                    $('#generalSettings').show();
                    $("#generalSettingsButton").addClass("active");
                    $("#positionSettingsButton").removeClass("active");
                    break;
                case 2:
                    $('#generalSettings').hide();
                    $('#positionSettings').show();
                    $("#positionSettingsButton").addClass("active");
                    $("#generalSettingsButton").removeClass("active");
                    break;
            }
        }

        function KassaOrDepClicked(state) {
            switch (state) {
                case 1:
                    $('#userKassaList').hide();
                    $('#userDepList').show();
                    $("#depTogle").addClass("active");
                    $("#kassaTogle").removeClass("active");
                    break;
                case 2:
                    $('#userKassaList').show();
                    $('#userDepList').hide();
                    $("#kassaTogle").addClass("active");
                    $("#depTogle").removeClass("active");
                    break;
            }
        }

        $("#rolesSelectDropdownMenu").on('click', function (event) {
            event.stopPropagation();
        });

        $('#rolesSelectDropdownMenu input[type="checkbox"]').on('change', function () {
            var selectedValues = [];
            $('#rolesSelectDropdownMenu input[type="checkbox"]:checked').each(function () {
                selectedValues.push($(this).val());
            });
            $("#newUserSpecialityContent").toggle(selectedValues.includes('4'));
        });

        $('#addPersonal').on('hidden.bs.modal', function () {
            var $form = $('#addPersonalForm');
            $form.removeClass('was-validated');
            $form[0].reset();
        });

        function addPersonal() {
            var forms = document.getElementsByClassName('needs-validation');
            Array.prototype.filter.call(forms, function (form) {
                if (form.checkValidity() === false) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            });
            if (forms[0].checkValidity()) {
                var newUserIsDr = $("#isDr").is(':checked') ? 1 : 0;
                var admin = $("#admin").is(':checked') ? 1 : 0;
                var name = $('#newUserName').val();
                var surname = $('#newUserSurname').val();
                var father = $('#newUserFather').val();
                var phone = $('#newUserMobile').val();
                var email = $('#newUserEmail').val();
                var bDate = $('#newUserBDate').val();
                var fin = $("#newUserFin").val();
                var passportSerialNo = $("#newUserPassportSerialNo").val();
                var username = $("#newUserUsername").val();
                var password = $("#newUserPwd").val();
                var specialityID = $('.newUserSpeciality').attr('id');
                var roleIds = [];
                $('#rolesSelectDropdownMenu input[type="checkbox"]:checked').each(function () {
                    roleIds.push($(this).val());
                });
                $('#systemModal').modal('show');
                $('#systemModalTitle').text("Yüklənir...");
                $('#systemModalText').html(`<center><div class="spinner-border text-dark mx-auto" role="status"></div></center>`);
                $('#systemModalBtn').attr("hidden", "");
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("Add", "Personal", new { area = "Admin" })",
                    data: {
                        "name": name,
                        "surname": surname,
                        "father": father,
                        "specialityID": specialityID,
                        "passportSerialNum": passportSerialNo,
                        "fin": fin,
                        "phone": phone,
                        "email": email,
                        "username": username,
                        "pwd": password,
                        "bDate": bDate,
                        "roleIds": roleIds
                    },
                    success: function (data, status, xhr) {
                        if (data > 0) {
                            $('#systemModal').modal('hide');
                            $('#warningModal').modal('show');
                            $('#warningText').text('Personal əlavə olundu!');
                        } else {
                            $('#systemModal').modal('hide');
                            $('#warningModal').modal('show');
                            $('#warningText').text('Personal artıq mövcuddur!');
                        }
                    },
                    error: function (jqXhr, textStatus, errorMessage) {
                        if (jqXhr.status == 401) {
                            $('#systemModalTitle').text("Sessiyanız başa çatıb");
                            $('#systemModalText').html(`<p>Zəhmət olmasa yenidən giriş edin</p>`);
                            $('#systemModalBtn').removeAttr("hidden");
                        } else {
                            $('#systemModal').modal('hide');
                            $('#warningModal').modal('show');
                            $('#warningText').text('Xəta, biraz sonra yenidən cəhd edin');
                        }
                    }
                });
            }
        }

        function addOrganizationToUser() {
            $.post("@Url.Action("AddOrganizationToUser", "Personal", new { area = "Admin" })",
                { userID: $("#reqCode").val(), organizationID: $("#allOrganizations").val() },
                function (data) {
                    if (data > 0) {
                        getOrganizationsByUser($('#reqCode').val());
                        $('#systemModal').modal('hide');
                        $('#warningModal').modal('show');
                        $('#warningText').text('Müəssisə əlavə olundu!');
                    } else {
                        $('#systemModal').modal('hide');
                        $('#warningModal').modal('show');
                        $('#warningText').text('Müəssisə artıq əlavə olunub!');
                    }
                }
            );
        }

        function removeOrganizationFromUser(organizationID) {
            $.post("@Url.Action("RemoveOrganizationFromUser", "Personal", new { area = "Admin" })",
                { userID: $("#reqCode").val(), organizationID: organizationID },
                function (data) {
                    if (data > 0) {
                        getOrganizationsByUser($('#reqCode').val());
                        $('#systemModal').modal('hide');
                        $('#warningModal').modal('show');
                        $('#warningText').text('Müəssisə silindi!');
                    } else {
                        $('#systemModal').modal('hide');
                        $('#warningModal').modal('show');
                        $('#warningText').text('Müəssisə silinmədi!');
                    }
                }
            );
        }

        function addDepartmentToUser() {
            var id = $("#depsInOrganization").find('option:selected').attr('id');
            $.post("@Url.Action("AddDepToUser", "Personal", new { area = "Admin" })",
                { userID: $("#reqCode").val(), depID: id, read_only: $("#depReadOnlyCheckBox").is(":checked"), full_access: $("#depFullControlCheckBox").is(":checked") },
                function (data) {
                    if (data > 0) {
                        getOrganizationsByUser($('#reqCode').val());
                        $('#systemModal').modal('hide');
                        $('#warningModal').modal('show');
                        $('#warningText').text('Şöbə əlavə olundu!');
                    } else {
                        $('#systemModal').modal('hide');
                        $('#warningModal').modal('show');
                        $('#warningText').text('Şöbə artıq əlavə olunub!');
                    }
                }
            );
        }

        function removeDepFromUser(userDepID) {
            $.post("@Url.Action("RemoveDepFromUser", "Personal", new { area = "Admin" })",
                { userID: $("#reqCode").val(), depID: userDepID },
                function (data) {
                    if (data > 0) {
                        getUserDepsByOrganization();
                        $('#systemModal').modal('hide');
                        $('#warningModal').modal('show');
                        $('#warningText').text('Şöbə silindi!');
                    } else {
                        $('#systemModal').modal('hide');
                        $('#warningModal').modal('show');
                        $('#warningText').text('Şöbə silinmədi!');
                    }
                }
            );
        }

        function addKassaToUser() {
            var id = $("#kassaInOrganization").find('option:selected').attr('id');
            $.post("@Url.Action("AddKassaToUser", "Personal", new { area = "Admin" })",
                { userID: $("#reqCode").val(), kassaId: id, read_only: $("#kassaReadOnlyCheckBox").is(":checked"), full_access: $("#kassaFullControlCheckBox").is(":checked") },
                function (data) {
                    if (data > 0) {
                        getUserKassaByOrganization();
                        $('#systemModal').modal('hide');
                        $('#warningModal').modal('show');
                        $('#warningText').text('Kassa əlavə olundu!');
                    } else {
                        $('#systemModal').modal('hide');
                        $('#warningModal').modal('show');
                        $('#warningText').text('Kassa artıq əlavə olunub!');
                    }
                }
            );
        }

        function removeKassaFromUser(kassaID) {
            $.post("@Url.Action("RemoveKassaFromUser", "Personal", new { area = "Admin" })",
                { userID: $("#reqCode").val(), kassaId: kassaID },
                function (data) {
                    if (data > 0) {
                        getUserKassaByOrganization();
                        $('#systemModal').modal('hide');
                        $('#warningModal').modal('show');
                        $('#warningText').text('Kassa silindi!');
                    } else {
                        $('#systemModal').modal('hide');
                        $('#warningModal').modal('show');
                        $('#warningText').text('Kassa silinmədi!');
                    }
                }
            );
        }
    </script>
}
